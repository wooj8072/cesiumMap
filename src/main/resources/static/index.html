<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <!-- Include the CesiumJS JavaScript and CSS files -->
    <script src="https://cesium.com/downloads/cesiumjs/releases/1.105/Build/Cesium/Cesium.js"></script>
    <link href="https://cesium.com/downloads/cesiumjs/releases/1.105/Build/Cesium/Widgets/widgets.css" rel="stylesheet">
<!--    <script src="https://unpkg.com/cesium-esri-widgets/Build/Cesium/Widgets/Esri/WorldView.js"></script>-->
<style>
    .cesium-widget, .cesium-widget canvas{
        width: 90%;
        height: 90%;
        touch-action: none;
    }
</style>
</head>
<body>
<div id="cesiumContainer"></div>
<button onclick="handleMouseClick()" >거리재기</button>
<script>
    // Your access token can be found at: https://ion.cesium.com/tokens.
    // This is the default access token from your ion account

    Cesium.Ion.defaultAccessToken = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiI2ZTM1ZjU1MC0yOTAyLTRlNTAtOGY4OS1lNzE5ZTAzYjNiZGEiLCJpZCI6MTM2ODU4LCJpYXQiOjE2ODMyODk3OTl9.F6W5Nwfwa9gVbg_GfSpy_5Jxyhz0rCCIRmTiMr2ZsCU';
    // Initialize the Cesium Viewer in the HTML element with the `cesiumContainer` ID.
    const viewer = new Cesium.Viewer('cesiumContainer', {
        terrainProvider: Cesium.createWorldTerrain(),
        animation: false,
        baseLayerPicker: false,
        fullscreenButton: false,
        vrButton: false,
        geocoder: false,
        homeButton: false,
        infoBox: false,
        sceneModePicker: false,
        selectionIndicator: false,
        timeline: false,
        navigationHelpButton: false,
        projectionPicker: false,
        selectedEntity: false,
        trackedEntity: false,
        clockTrackedDataSource: false,
    });
    // Add Cesium OSM Buildings, a global 3D buildings layer.
    const buildingTileset = viewer.scene.primitives.add(Cesium.createOsmBuildings());

    var destination = Cesium.Cartesian3.fromDegrees(127.110697, 37.381234, 1000);//카메라 좌표설정
    viewer.camera.flyTo({
        destination: destination,
        duration: 1,
        orientation: {
            heading: Cesium.Math.toRadians(0.0), //지도방향
            pitch: Cesium.Math.toRadians(-90.0),  //지도 기울기
            roll: Cesium.Math.toRadians(0.0),   //지도회전
            zoomOutAmount: 2.0                  //지도축척
        }
    });


    //5번
    var points = [];

    var handler = new Cesium.ScreenSpaceEventHandler(viewer.scene.canvas);

    var total = 0;

    handler.setInputAction(function (click) {
        var windowPosition = new Cesium.Cartesian2(click.position.x, click.position.y);
        var pickRay = viewer.camera.getPickRay(windowPosition);
        var intersection = viewer.scene.globe.pick(pickRay, viewer.scene);

        if (Cesium.defined(intersection)) {
            var point = intersection;
            addPointMarker(point);
            points.push(point);

            if (points.length >= 2) {
                var totalDistance = 0;
                for (var i = 1; i < points.length; i++) {
                    var distance = Cesium.Cartesian3.distance(points[i - 1], points[i]);
                    totalDistance += distance;
                }
                total = totalDistance.toFixed(2);
                // console.log('Total distance: ' + totalDistance.toFixed(2) + ' meters');
            }
        }
    }, Cesium.ScreenSpaceEventType.LEFT_CLICK);

    handler.setInputAction(function (click) {
        alert("총거리는 : " + total);
        total = 0;
    }, Cesium.ScreenSpaceEventType.RIGHT_CLICK);

    //점 스타일 속성
    function addPointMarker(position) {
        viewer.entities.add({
            position: position,
            point: {
                pixelSize: 7,
                color: Cesium.Color.GREEN,
                outlineColor: Cesium.Color.BLACK,
                outlineWidth: 2
            }
        });
    }
    // function click(event) {
    //     // 마우스 클릭 위치의 3D 좌표
    //     var mousePosition = new Cesium.Cartesian2(event.clientX, event.clientY); //xy좌표
    //     var pickedPosition = viewer.scene.pickPosition(mousePosition);
    //
    //     if (Cesium.defined(pickedPosition)) {
    //         // 선택한 좌표를 사용하여 원하는 작업을 수행합니다.
    //         console.log('Selected position:', pickedPosition);
    //     }
    // }


    //두점사이의 거리 구한 후 이어서
    // var worldView = new Cesium.EsriWorldView({
    //     container: 'cesiumContainer',
    //     map: viewer.scene.map
    // });
    // worldView.distanceMeasurementEnabled = true;
    // var measurementResult = worldView.distanceMeasurementResult;
    // var distance = measurementResult.distance;
    // console.log('Distance:', distance);

</script>
</div>
</body>
</html>