<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <!-- Include the CesiumJS JavaScript and CSS files -->
    <script src="https://cesium.com/downloads/cesiumjs/releases/1.105/Build/Cesium/Cesium.js"></script>
    <link href="https://cesium.com/downloads/cesiumjs/releases/1.105/Build/Cesium/Widgets/widgets.css" rel="stylesheet">
<!--    <script src="https://unpkg.com/cesium-esri-widgets/Build/Cesium/Widgets/Esri/WorldView.js"></script>-->
<style>
    .cesium-widget, .cesium-widget canvas{
        width: 100%;
        height: 100%;
        touch-action: none;
    }
</style>
</head>
<body>
<div id="cesiumContainer"></div>
<button onclick="handleMouseClick()" >거리재기</button>
<script>
    // Your access token can be found at: https://ion.cesium.com/tokens.
    // This is the default access token from your ion account

    Cesium.Ion.defaultAccessToken = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiI2ZTM1ZjU1MC0yOTAyLTRlNTAtOGY4OS1lNzE5ZTAzYjNiZGEiLCJpZCI6MTM2ODU4LCJpYXQiOjE2ODMyODk3OTl9.F6W5Nwfwa9gVbg_GfSpy_5Jxyhz0rCCIRmTiMr2ZsCU';
    // Initialize the Cesium Viewer in the HTML element with the `cesiumContainer` ID.
    const viewer = new Cesium.Viewer('cesiumContainer', {
        terrainProvider: Cesium.createWorldTerrain(),
        animation: false,
        baseLayerPicker: false,
        fullscreenButton: false,
        vrButton: false,
        geocoder: false,
        homeButton: false,
        infoBox: false,
        sceneModePicker: false,
        selectionIndicator: false,
        timeline: false,
        navigationHelpButton: false,
        projectionPicker: false,
        selectedEntity: false,
        trackedEntity: false,
        clockTrackedDataSource: false,
    });
    // Add Cesium OSM Buildings, a global 3D buildings layer.
    const buildingTileset = viewer.scene.primitives.add(Cesium.createOsmBuildings());

    var destination = Cesium.Cartesian3.fromDegrees(127.110697, 37.381234, 1000);//카메라 좌표설정
    viewer.camera.flyTo({
        destination: destination,
        duration: 1,
        orientation: {
            heading: Cesium.Math.toRadians(0.0), //지도방향
            pitch: Cesium.Math.toRadians(-90.0),  //지도 기울기
            roll: Cesium.Math.toRadians(0.0),   //지도회전
            zoomOutAmount: 2.0                  //지도축척
        }
    });

    var points = [];
    var totalDistance = 0;
    var startMarker = null;

    var distanceLabel = viewer.entities.add({ //총 거리 나타내는 라벨
        label: {
            show: false,
            showBackground: true,
            backgroundColor: Cesium.Color.WHITE,
            font: '14px monospace',
            fillColor: Cesium.Color.BLACK,
            horizontalOrigin: Cesium.HorizontalOrigin.LEFT,
            verticalOrigin: Cesium.VerticalOrigin.TOP,
            pixelOffset: new Cesium.Cartesian2(15, 0)
        }
    });

    var handler = new Cesium.ScreenSpaceEventHandler(viewer.scene.canvas);


    handler.setInputAction(function (click) {
        var windowPosition = new Cesium.Cartesian2(click.position.x, click.position.y);
        var pickRay = viewer.camera.getPickRay(windowPosition);
        var intersection = viewer.scene.globe.pick(pickRay, viewer.scene);

        if (Cesium.defined(intersection)) {
            var point = intersection;
            if (!startMarker) {
                startMarker = addPointMarker(point, Cesium.Color.GREEN);
            } else {
                addPointMarker(point, Cesium.Color.RED);
                var distance = Cesium.Cartesian3.distance(startMarker.position.getValue(), point);
                totalDistance += distance;
                distanceLabel.label.show = true;
                distanceLabel.position = point;
                distanceLabel.label.text = 'Total distance: ' + totalDistance.toFixed(2) + ' meters';
            }
            points.push(point);
        }
    }, Cesium.ScreenSpaceEventType.LEFT_CLICK);

    handler.setInputAction(function (click) {
        startMarker = null;
        points = [];
        totalDistance = 0;
        return;
    }, Cesium.ScreenSpaceEventType.RIGHT_CLICK);

    function addPointMarker(position, color) {
        return viewer.entities.add({
            position: position,
            point: {
                pixelSize: 7,
                color: color,
                // outlineColor: Cesium.Color.BLACK,
                // outlineWidth: 2
            }
        });
    }
</script>
</div>
</body>
</html>