<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <!-- Include the CesiumJS JavaScript and CSS files -->
    <script src="https://cesium.com/downloads/cesiumjs/releases/1.105/Build/Cesium/Cesium.js"></script>
    <link href="https://cesium.com/downloads/cesiumjs/releases/1.105/Build/Cesium/Widgets/widgets.css" rel="stylesheet">
<!--    <script src="https://unpkg.com/cesium-esri-widgets/Build/Cesium/Widgets/Esri/WorldView.js"></script>-->
<style>
    .cesium-widget, .cesium-widget canvas{
        width: 90%;
        height: 90%;
        touch-action: none;
    }
</style>
</head>
<body>
<div id="cesiumContainer"></div>
<button onclick="handleMouseClick()" >거리재기</button>
<script>
    // Your access token can be found at: https://ion.cesium.com/tokens.
    // This is the default access token from your ion account

    Cesium.Ion.defaultAccessToken = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiI2ZTM1ZjU1MC0yOTAyLTRlNTAtOGY4OS1lNzE5ZTAzYjNiZGEiLCJpZCI6MTM2ODU4LCJpYXQiOjE2ODMyODk3OTl9.F6W5Nwfwa9gVbg_GfSpy_5Jxyhz0rCCIRmTiMr2ZsCU';
    // Initialize the Cesium Viewer in the HTML element with the `cesiumContainer` ID.
    const viewer = new Cesium.Viewer('cesiumContainer', {
        terrainProvider: Cesium.createWorldTerrain(),
        animation: false,
        baseLayerPicker: false,
        fullscreenButton: false,
        vrButton: false,
        geocoder: false,
        homeButton: false,
        infoBox: false,
        sceneModePicker: false,
        selectionIndicator: false,
        timeline: false,
        navigationHelpButton: false,
        projectionPicker: false,
        selectedEntity: false,
        trackedEntity: false,
        clockTrackedDataSource: false,
    });
    // Add Cesium OSM Buildings, a global 3D buildings layer.
    const buildingTileset = viewer.scene.primitives.add(Cesium.createOsmBuildings());

    var destination = Cesium.Cartesian3.fromDegrees(127.110697, 37.381234, 1000);//카메라 좌표설정
    viewer.camera.flyTo({
        destination: destination,
        duration: 1,
        orientation: {
            heading: Cesium.Math.toRadians(0.0), //지도방향
            pitch: Cesium.Math.toRadians(-90.0),  //지도 기울기
            roll: Cesium.Math.toRadians(0.0),   //지도회전
            zoomOutAmount: 2.0                  //지도축척
        }
    });


    // //5번 <시작>
    javascript
    Copy code
    var viewer = new Cesium.Viewer('cesiumContainer');

    var handler = new Cesium.ScreenSpaceEventHandler(viewer.scene.canvas);
    var points = [];
    var totalDistance = 0;
    var startMarker = null;
    var distanceLabel = viewer.entities.add({
        label: {
            show: false,
            showBackground: true,
            backgroundColor: Cesium.Color.WHITE,
            font: '14px monospace',
            fillColor: Cesium.Color.BLACK,
            horizontalOrigin: Cesium.HorizontalOrigin.LEFT,
            verticalOrigin: Cesium.VerticalOrigin.TOP,
            pixelOffset: new Cesium.Cartesian2(15, 0)
        }
    });

    handler.setInputAction(function(click) {
        if (Cesium.ScreenSpaceEventType.RIGHT_CLICK === click.event.type) {
            // 마우스 우클릭 시 총 거리 라벨로 표시하고 초기화
            distanceLabel.label.show = true;
            distanceLabel.label.text = 'Total distance: ' + totalDistance.toFixed(2) + ' meters';

            // 새로운 거리 재기를 위해 변수 초기화
            points = [];
            totalDistance = 0;
            startMarker = null;
            return;
        }

        var windowPosition = click.position;

        var pickedObject = viewer.scene.pick(windowPosition);
        if (Cesium.defined(pickedObject)) {
            var cartesian = viewer.scene.pickPosition(windowPosition);
            var cartographic = Cesium.Cartographic.fromCartesian(cartesian);
            var longitude = Cesium.Math.toDegrees(cartographic.longitude);
            var latitude = Cesium.Math.toDegrees(cartographic.latitude);
            var height = cartographic.height;

            console.log('Clicked at:', longitude, latitude, height);

            if (!startMarker) {
                startMarker = addPointMarker(cartesian, Cesium.Color.GREEN);
            } else {
                addPointMarker(cartesian, Cesium.Color.RED);
                var distance = Cesium.Cartesian3.distance(startMarker.position.getValue(), cartesian);
                totalDistance += distance;
                console.log('Partial distance:', distance.toFixed(2), 'meters');
            }
            points.push(cartesian);
        }
    }, Cesium.ScreenSpaceEventType.LEFT_CLICK);

    function addPointMarker(position, color) {
        return viewer.entities.add({
            position: position,
            point: {
                pixelSize: 10,
                color: color,
                outlineColor: Cesium.Color.BLACK,
                outlineWidth: 2
            }
        });
    }

</script>
</body>
</html>